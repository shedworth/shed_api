from django.shortcuts import render
from django.http import HttpResponse
from django.views.generic.base import TemplateView
from . import Shedshow
from .forms import ControlForm, ExtendedControlForm
import copy
# Create your views here.
def control_shed(request):
	submitted = False
	if request.method == 'GET':
		initial_values = {**Shedshow.stored_values_A, **Shedshow.stored_values_B, **Shedshow.stored_values_C}				# Set form values to currently held values
		#initial_values['fixture'] = 0																																																				
		#initial_values['pattern'] = 1
		form = ExtendedControlForm(initial=initial_values)																			# Form to send to template, initialised with currently held values
		if 'submitted' in request.GET:
			submitted = True
	
	if request.method == 'POST':
		form = ExtendedControlForm(request.POST)
		if form.is_valid():
			
		
			
			for fixture, stored_values in Shedshow.fixture_list.items():
				print(fixture)		
				shed_params = {}
				for parameter in request.POST:
					#print(request.POST.get(parameter))
					if parameter in stored_values.keys():	
						stored_values[parameter] = request.POST.get(parameter)	
						shed_params[str(parameter[:-2])] = int(request.POST.get(parameter))	
				shed_params['fixture'] = fixture
				Shedshow.control_shed(shed_params)
				
#			shed_params = {}
#			for parameter in request.POST:
#				if parameter in Shedshow.stored_values_B.keys():
#					Shedshow.stored_values_B[parameter] = request.POST.get(parameter)	
#					shed_params[str(parameter[:-2])] = int(request.POST.get(parameter))				
#			shed_params['fixture'] = 2
#			Shedshow.control_shed(shed_params)
#			
#			shed_params = {}
#			for parameter in request.POST:
#				if parameter in Shedshow.stored_values_C.keys():
#					Shedshow.stored_values_C[parameter] = request.POST.get(parameter)						
#					shed_params[str(parameter[:-2])] = int(request.POST.get(parameter))	
#			shed_params['fixture'] = 3
#			Shedshow.control_shed(shed_params)
		
	return render(request, 'home.html', {'form': form, 'submitted': submitted})	
	
		#return HttpResponse('Control sent')
	



